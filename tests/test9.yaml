substitutions:
  name: bms
  friendly_name: BMS

esphome:
  name: ${name}
  friendly_name: ${friendly_name}
  name_add_mac_suffix: false
  project:
    name: esphome.bms
    version: "1.0"

esp32:
  board: esp32thing_plus
  framework:
    type: arduino

wifi:
  networks:
    - ssid: "MySSID"
      password: "password1"
    - ssid: "MySSID2"
      password: ""
      channel: 14
      bssid: "A1:63:95:47:D3:1D"

web_server:
  port: 80


api:

logger:
  level: DEBUG

ota:

button:
- platform: safe_mode
  name: Safe Mode Boot
  entity_category: diagnostic


# Canbus stuff for battery monitoring

spi:
  clk_pin: GPIO5
  mosi_pin: GPIO18
  miso_pin: GPIO19

canbus:
  - id: can0
    platform: mcp2515
    cs_pin: GPIO4
    can_id: 0x35E
    bit_rate: 500kbps
    clock: 16MHZ
  - id: can1
    platform: mcp2515
    cs_pin: GPIO16
    can_id: 0x35E
    bit_rate: 500kbps
    clock: 16MHZ
  - id: can2
    platform: mcp2515
    cs_pin: GPIO27
    clock: 12MHZ
    bit_rate: 500kbps
    can_id: 0x35E

canbus_bms:
  - id: byd_bms
    canbus_id: can0
    debug: false
    name: BYD Battery
    throttle: 10s
    timeout: 30s
  - id: jakiper_bms
    canbus_id: can1
    name: Jakiper Battery
    debug: false
    throttle: 10s
    timeout: 30s

binary_sensor:
  - platform: canbus_bms
    bms_id: jakiper_bms
    charge_enable:
      name: Jakiper Charge Enable
    discharge_enable:
      name: Jakiper Discharge Enable
    force_charge_1:
      name: Jakiper Force Charge 1
    force_charge_2:
      name: Jakiper Force Charge 2
    request_full_charge:
      name: Jakiper Request Full Charge
    warnings:
      name: Jakiper Warnings
    alarms:
      name: Jakiper Alarms

  - platform: canbus_bms
    bms_id: byd_bms
    warnings:
      name: BYD Warnings
    alarms:
      name: BYD Alarms

sensor:
  - platform: canbus_bms
    bms_id: byd_bms
    temperature:
      name: BYD Temperature
    voltage:
      name: BYD Voltage
    current:
      name: BYD Current
    charge:
      name: BYD Charge
    health:
      name: BYD Health
    max_charge_voltage:
      name: BYD Max Charge Voltage
    max_charge_current:
      name: BYD Max Charge Current
    max_discharge_current:
      name: BYD Max Discharge Current
    min_discharge_voltage:
      name: BYD Min Discharge Voltage
      filters:
        throttle: 5s

  - platform: canbus_bms
    bms_id: jakiper_bms
    temperature:
      name: Jakiper Temperature
    voltage:
      name: Jakiper Voltage
    current:
      name: Jakiper Current
    charge:
      name: Jakiper Charge
    health:
      name: Jakiper Health
    max_charge_voltage:
      name: Jakiper Max Charge Voltage
    max_charge_current:
      name: Jakiper Max Charge Current
    max_discharge_current:
      name: Jakiper Max Discharge Current
    min_discharge_voltage:
      name: Jakiper Min Discharge Voltage

text_sensor:
  - platform: canbus_bms
    bms_id: byd_bms
    bms_name:
      name: BYD BMS Name
    warnings:
      name: BYD Warnings
    alarms:
      name: BYD Alarms

  - platform: canbus_bms
    bms_id: jakiper_bms
    bms_name:
      name: Jakiper BMS Name
    warnings:
      name: Jakiper Warnings
    alarms:
      name: Jakiper Alarms
